aggregates:
  SkillProcess:
    metadata:
      Preprocessors: ["MOVE_CRUD_IT"]
      CRUD_IT_NO_UPDATE: true
      CRUD_IT_NO_DELETE: true
      NO_MOVE_EVENT_MODULE: true
      ShouldIssuePublisherObject: true
    id:
      name: SkillProcessId
      type: SkillTypePlayerIdPair
      generator:
        class: assigned
        tableName: SkillProcessTable
    properties:
      ItemId:
        type: u32
        defaultLogic:
          Move: "infinite_sea_common::item_id::unused_item()"
      StartedAt:
        type: u64
        defaultLogic:
          Move: "0"
      CreationTime:
        type: u64
        defaultLogic:
          Move: "0"
      Completed:
        type: bool
        defaultLogic:
          Move: "true"
      EndedAt:
        type: u64
        defaultLogic:
          Move: "0"
    methods:
      Create:
        event:
          isObjectShared: true # Share the object after created.
        constants:
          EFormNotSubmitted:
            name: EInvalidPlayerId
            constantExpression:
              Move: 10
            type: u64
        verificationLogic:
          Move: >
            let player_id = infinite_sea_common::skill_type_player_id_pair::player_id(&skill_process_id);
                    assert!(sui::tx_context::sender(ctx) == player_id, EInvalidPlayerId);

      #StartCreation: # todo start item creation
      StartProduction:
        parameters:
          Player:
            referenceType: Player
            isMutableReference: true
            isIgnoredInEvent: true
          ItemProduction:
            referenceType: ItemProduction
            #eventPropertyName: ItemProductionId
            isIgnoredInEvent: true
          Clock:
            referenceType: Clock
            isIgnoredInEvent: true
          #EnergyCoin: # todo Energy Coin
          #  referenceType: Coin<ENERGY_COIN>
          #  eventPropertyName: EnergyCost
        event:
          name: ProductionProcessStarted
          properties:
            ItemId:
              type: u32
            EnergyCost:
              type: u64
            StartedAt:
              type: u64
            CreationTime:
              type: u64

      CompleteProduction:
        parameters:
          Player:
            referenceType: Player
            isMutableReference: true
            isIgnoredInEvent: true
          ItemProduction:
            referenceType: ItemProduction
            isIgnoredInEvent: true
          ExperienceTable:
            referenceType: ExperienceTable
            isIgnoredInEvent: true
          Clock:
            referenceType: Clock
            isIgnoredInEvent: true
        event:
          name: ProductionProcessCompleted
          properties:
            ItemId:
              type: u32
            StartedAt:
              type: u64
            CreationTime:
              type: u64
            EndedAt:
              type: u64
            Successful:
              type: bool


  SkillProcessMutex:
    module: "Common"
    id:
      name: PlayerId
      type: address
      generator:
        class: assigned
        tableName: SkillProcessMutexTable
    properties:
      ActiveSkillType:
        type: SkillType
        optional: true

  ItemCreation:
    metadata:
      Preprocessors: ["MOVE_CRUD_IT"]
      #CRUD_IT_NO_UPDATE: true
      CRUD_IT_NO_DELETE: true
    implements:
      - ItemCreationOrProduction
    id:
      name: ItemCreationId
      type: SkillTypeItemIdPair
      generator:
        class: assigned
        tableName: ItemCreationTable
    properties:

  ItemProduction:
    metadata:
      Preprocessors: ["MOVE_CRUD_IT"]
      #CRUD_IT_NO_UPDATE: true
      CRUD_IT_NO_DELETE: true
    implements:
      - ItemCreationOrProduction
    id:
      name: ItemProductionId
      type: SkillTypeItemIdPair
      generator:
        class: assigned
        tableName: ItemProductionTable
    properties:
      ProductionMaterials:
        type: ProductionMaterials


superObjects:
  ItemCreationOrProduction:
    properties:
      #RequirementsSkill:
      #  type: SkillType
      RequirementsLevel:
        type: u16
      BaseQuantity:
        type: u32
      BaseExperience:
        type: u32
      BaseCreationTime:
        type: u64
      EnergyCost:
        type: u32
      SuccessRate: #(percentage)
        type: u16


configuration:
  sequenceNumber: 1000
  metadata:
    NO_MOVE_EVENT_MODULE: true

  defaultModule:
    name: "Sui.InfiniteSea"
    requiredModules: [ "Common" ]
  submodules:
    Common:
      requiredModules: [ ]
