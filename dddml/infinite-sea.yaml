aggregates:
  FarmingProcess:
    module: "Farming"
    implements:
      - SkillProcess
    id:
      name: PlayerId
      type: address
      generator:
        class: signer
        tableName: FarmingProcessTable

  FarmingItemProduction:
    module: "Farming"
    metadata:
      Preprocessors: ["MOVE_CRUD_IT"]
      CRUD_IT_NO_UPDATE: true
      CRUD_IT_NO_DELETE: true
    id:
      name: ItemId
      type: u32
      generator:
        class: assigned
        tableName: FarmingItemProductionTable
    properties:
      ItemProduction:
        type: ItemProduction
    methods:
      #Create:
        #event:
        #  name: FarmingItemProductionCreated

  MiningProcess:
    module: "Mining"
    implements:
      - SkillProcess
    id:
      name: PlayerId
      type: address
      generator:
        class: signer
        tableName: MiningProcessTable

  MiningItemCreation:
    module: "Mining"
    id:
      name: ItemId
      type: u32
      generator:
        class: assigned
        tableName: MiningItemCreationTable
    properties:
      ItemCreation:
        type: ItemCreation

  SmithingProcess:
    module: "Smithing"
    implements:
      - SkillProcess
    id:
      name: PlayerId
      type: address
      generator:
        class: signer
        tableName: SmithingProcessTable

  SmithingItemProduction:
    module: "Smithing"
    id:
      name: ItemId
      type: u32
      generator:
        class: assigned
        tableName: SmithingItemProductionTable
    properties:
      ItemProduction:
        type: ItemProduction

  Player:
    module: "Player"
    metadata:
      #Preprocessors: ["MOVE_CRUD_IT"]
      NO_MOVE_EVENT_MODULE: true
    id:
      name: PlayerId
      type: address
      generator:
        class: signer
        tableName: PlayerTable
    properties:
      #Nickname:
      #  type: AsciiString
      #  length: 50
      Level:
        type: u16
      Experience:
        type: u32
      #Intro:
      #  type: String
      #  length: 350

  SkillProcessMutex:
    module: "Common"
    id:
      name: PlayerId
      type: address
      generator:
        class: assigned
        tableName: SkillProcessMutexTable
    properties:
      ActiveSkillType:
        type: SkillType
        optional: true

  Item:
    module: "Common"
    id:
      name: ItemId
      type: u32
      generator:
        class: assigned
        tableName: ItemTable
    properties:
      Name:
        type: AsciiString
        length: 100
      #Type:
      #  type: ItemType
      RequiredForCompletion:
        type: bool
      SellsFor:
        type: u32


valueObjects:
  ExperienceTableItem:
    module: "Common"
    properties:
      Level:
        type: u16
      Experience:
        type: u32
      Difference:
        type: u32

  ItemCreation:
    module: "Common"
    properties:
      #RequirementsSkill:
      #  type: SkillType
      RequirementsLevel:
        type: u16
      BaseQuantity:
        type: u32
      BaseExperience:
        type: u32
      BaseCreationTime:
        type: u64
      EnergyCost:
        type: u32

  ItemProduction:
    module: "Common"
    properties:
      RequirementsLevel:
        type: u16
      Materials:
        itemType: ProductionMaterial
        isList: true
      BaseQuantity:
        type: u32
      BaseExperience:
        type: u32
      BaseCreationTime:
        type: u64
      EnergyCost:
        type: u32
      SuccessRate: #(percentage)
        type: u16
    methods:
      New:
        isConstructor: true
        parameters:
          RequirementsLevel:
            type: u16
          MaterialItemId_1:
            type: u32
          MaterialQuantity_1:
            type: u32
          MaterialItemId_2:
            type: u32
            optional: true
          MaterialQuantity_2:
            type: u32
            optional: true
          MaterialItemId_3:
            type: u32
            optional: true
          MaterialQuantity_3:
            type: u32
            optional: true
          MaterialItemId_4:
            type: u32
            optional: true
          MaterialQuantity_4:
            type: u32
            optional: true
          MaterialItemId_5:
            type: u32
            optional: true
          MaterialQuantity_5:
            type: u32
            optional: true
          BaseQuantity:
            type: u32
          BaseExperience:
            type: u32
          BaseCreationTime:
            type: u64
          EnergyCost:
            type: u32
          SuccessRate: #(percentage)
            type: u16
        implementationLogic:
          Move: >-
            let materials = std::vector::empty();
                    std::vector::push_back(
                        &mut materials,
                        infinite_sea_common::production_material::new(material_item_id_1, material_quantity_1)
                    );
                    if (std::option::is_some(&material_item_id_2)) {
                        std::vector::push_back(
                            &mut materials,
                            infinite_sea_common::production_material::new(
                                std::option::extract(&mut material_item_id_2),
                                std::option::extract(&mut material_quantity_2)
                            )
                        );
                    };
                    if (std::option::is_some(&material_item_id_3)) {
                        std::vector::push_back(
                            &mut materials,
                            infinite_sea_common::production_material::new(
                                std::option::extract(&mut material_item_id_3),
                                std::option::extract(&mut material_quantity_3)
                            )
                        );
                    };
                    if (std::option::is_some(&material_item_id_4)) {
                        std::vector::push_back(
                            &mut materials,
                            infinite_sea_common::production_material::new(
                                std::option::extract(&mut material_item_id_4),
                                std::option::extract(&mut material_quantity_4)
                            )
                        );
                    };
                    if (std::option::is_some(&material_item_id_5)) {
                        std::vector::push_back(
                            &mut materials,
                            infinite_sea_common::production_material::new(
                                std::option::extract(&mut material_item_id_5),
                                std::option::extract(&mut material_quantity_5)
                            )
                        );
                    };
                    {_INSTANTIATE_STRUCT_}

  ProductionMaterial:
    module: "Common"
    properties:
      ItemId:
        type: u32
      Quantity:
        type: u32
        #1  Copper Ore
        #1  Tin Ore


enumObjects:
  SkillType:
    module: "Common"
    baseType: u8
    values:
      Farming:
        value: 0
      Woodcutting:
        value: 1
      Fishing:
        value: 2
      Mining:
        value: 3
      Smithing:
        value: 4
      Cooking:
        value: 5
      Crafting:
        value: 6
      Township:
        value: 7
      #Thieving:
      #  value: xxx

#  IslandResourceType:
#    module: "Common"
#    baseType: u8
#    values:
#      Seed:
#        value: 0
#      Wood:
#        value: 1
#      Fish:
#        value: 2
#      Mineral:
#        value: 3

#  ItemType:
#    module: "Common"
#    baseType: u8
#    values:
#      Logs:
#        value: 0


singletonObjects:
  ExperienceTable:
    module: "Common"
    properties:
      Items:
        itemType: ExperienceTableItem
    methods:
      "__Init__":
        event:
          isObjectShared: true # Share the object after initialization.


superObjects:
  SkillProcess:
    properties:
      ItemId:
        type: u32
      StartTime:
        type: u64
      EndTime:
        type: u64


configuration:
  sequenceNumber: 1000
  metadata:
    NO_MOVE_EVENT_MODULE: true

  defaultModule:
    name: "Sui.InfiniteSea"
    requiredModules: [ "Common", "Player" ]
  submodules:
    Farming:
      requiredModules: [ "Common", "Player"  ]
    Mining:
      requiredModules: [ "Common", "Player" ]
    Smithing:
      requiredModules: [ "Common", "Player" ]
    Player:
      requiredModules: [ ]
    Common:
      requiredModules: [ ]
