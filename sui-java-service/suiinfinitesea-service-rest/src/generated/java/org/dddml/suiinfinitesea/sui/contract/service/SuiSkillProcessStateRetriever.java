// <autogenerated>
//   This file was generated by dddappp code generator.
//   Any changes made to this file manually will be lost next time the file is regenerated.
// </autogenerated>

package org.dddml.suiinfinitesea.sui.contract.service;

import com.github.wubuku.sui.bean.*;
import com.github.wubuku.sui.utils.*;
import org.dddml.suiinfinitesea.domain.skillprocess.*;
import org.dddml.suiinfinitesea.domain.*;
import org.dddml.suiinfinitesea.sui.contract.DomainBeanUtils;
import org.dddml.suiinfinitesea.sui.contract.SkillProcess;

import java.util.*;
import java.math.*;
import java.util.function.*;

public class SuiSkillProcessStateRetriever {

    private SuiJsonRpcClient suiJsonRpcClient;

    private Function<SkillProcessId, SkillProcessState.MutableSkillProcessState> skillProcessStateFactory;

    public SuiSkillProcessStateRetriever(SuiJsonRpcClient suiJsonRpcClient,
                                  Function<SkillProcessId, SkillProcessState.MutableSkillProcessState> skillProcessStateFactory
    ) {
        this.suiJsonRpcClient = suiJsonRpcClient;
        this.skillProcessStateFactory = skillProcessStateFactory;
    }

    public SkillProcessState retrieveSkillProcessState(String objectId) {
        SuiMoveObjectResponse<SkillProcess> getObjectDataResponse = suiJsonRpcClient.getMoveObject(
                objectId, new SuiObjectDataOptions(true, true, true, true, true, true, true), SkillProcess.class
        );
        if (getObjectDataResponse.getData() == null) {
            return null;
        }
        SkillProcess skillProcess = getObjectDataResponse.getData().getContent().getFields();
        return toSkillProcessState(skillProcess);
    }

    private SkillProcessState toSkillProcessState(SkillProcess skillProcess) {
        SkillProcessState.MutableSkillProcessState skillProcessState = skillProcessStateFactory.apply(DomainBeanUtils.toSkillProcessId(skillProcess.getSkillProcessId()));
        skillProcessState.setId_(skillProcess.getId().getId());
        skillProcessState.setVersion(skillProcess.getVersion());
        skillProcessState.setItemId(skillProcess.getItemId());
        skillProcessState.setStartedAt(skillProcess.getStartedAt());
        skillProcessState.setCreationTime(skillProcess.getCreationTime());
        skillProcessState.setCompleted(skillProcess.getCompleted());
        skillProcessState.setEndedAt(skillProcess.getEndedAt());
        skillProcessState.setEnergyVault(skillProcess.getEnergyVault());
        return skillProcessState;
    }

    
}

